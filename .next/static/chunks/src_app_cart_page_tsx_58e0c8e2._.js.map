{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/theek/Documents/DA%20Project/smart-parts/web/src/app/cart/page.tsx"],"sourcesContent":["\"use client\";\n\nimport useSWR from \"swr\";\nimport { api } from \"@/lib/api\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useMemo, useState } from \"react\";\nimport { Trash2, Plus, Minus, ShoppingCart, CreditCard } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\n\ntype CartAPI = {\n  cart?: {\n    items: Array<{\n      _id?: string;\n      partId: { _id: string; name: string; price?: number; sku?: string; brand?: string };\n      qty: number;\n      selectedLocationId?: string;\n    }>;\n  };\n};\n\nexport default function CartPage() {\n  const { token } = useAuth();\n  const router = useRouter();\n\n  // ✅ Always call the hook (pass null key to skip fetch when no token)\n  const { data, error, mutate, isLoading } = useSWR<CartAPI>(token ? \"/api/cart\" : null, api);\n\n  const [busyId, setBusyId] = useState<string | null>(null);\n\n  // Safe derived values BEFORE any early returns\n  const cart = data?.cart || { items: [] };\n\n  const totals = useMemo(() => {\n    const sub = cart.items.reduce((sum, it) => sum + (it.partId.price ?? 0) * it.qty, 0);\n    return { subtotal: sub, grand: sub }; // tax/shipping can be added server-side\n  }, [cart.items]);\n\n  // Plain helper (not a hook)\n  function fmt(v?: number) {\n    if (typeof v !== \"number\") return \"-\";\n    try {\n      return new Intl.NumberFormat(undefined, { style: \"currency\", currency: \"LKR\" }).format(v);\n    } catch {\n      return `$${v.toFixed(2)}`;\n    }\n  }\n\n  async function updateQty(partId: string, newQty: number) {\n    if (newQty < 1) return;\n    setBusyId(partId);\n    try {\n      await api(\"/api/cart/items\", {\n        method: \"PUT\",\n        body: JSON.stringify({ partId, qty: newQty }),\n      });\n      await mutate();\n    } finally {\n      setBusyId(null);\n    }\n  }\n\n  async function removeItem(partId: string) {\n    setBusyId(partId);\n    try {\n      await api(`/api/cart/items`, {\n        method: \"DELETE\",\n        body: JSON.stringify({ partId }),\n      });\n      await mutate();\n    } finally {\n      setBusyId(null);\n    }\n  }\n\n  async function goCheckout() {\n    const res = await api<{ url: string }>(\"/api/payments/checkout\", {\n      method: \"POST\",\n      body: JSON.stringify({}),\n    });\n    window.location.href = res.url;\n  }\n\n  // You can still branch UI here — hooks are already called above.\n  if (!token) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\n        <div className=\"text-center\">\n          <p className=\"text-slate-600 dark:text-slate-300\">\n            Please <a className=\"text-blue-600 dark:text-blue-400 underline\" href=\"/login\">login</a> to view your cart.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) return <div className=\"p-6\">Error loading.</div>;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 dark:from-slate-950 dark:via-slate-900 dark:to-slate-800 p-4 md:p-8\">\n      <div className=\"pointer-events-none fixed inset-0 bg-[radial-gradient(circle_at_50%_20%,rgba(120,119,198,0.10),transparent_50%)] dark:bg-[radial-gradient(circle_at_50%_20%,rgba(120,119,198,0.05),transparent_50%)]\" />\n      <div className=\"relative mx-auto max-w-6xl pt-22\">\n        <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border border-slate-200/50 dark:border-slate-700/50 rounded-2xl shadow-2xl p-6 md:p-10\">\n          <div className=\"flex items-center gap-3 mb-6\">\n            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow\">\n              <ShoppingCart className=\"w-6 h-6 text-white\" />\n            </div>\n            <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900 dark:text-white\">Your Cart</h1>\n          </div>\n\n          {/* Empty state */}\n          {!isLoading && cart.items.length === 0 && (\n            <div className=\"rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/70 p-8 text-center\">\n              <p className=\"text-slate-700 dark:text-slate-300\">No items in your cart.</p>\n              <button\n                onClick={() => router.push(\"/catalog\")}\n                className=\"mt-4 inline-flex items-center justify-center rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 px-4 py-2 hover:opacity-90 transition\"\n              >\n                Continue shopping\n              </button>\n            </div>\n          )}\n\n          {/* Items */}\n          {cart.items.length > 0 && (\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              <section className=\"lg:col-span-2\">\n                <ul className=\"space-y-4\">\n                  {cart.items.map((it) => {\n                    const pid = it.partId._id;\n                    const price = it.partId.price ?? 0;\n                    return (\n                      <li\n                        key={pid}\n                        className=\"rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/70 p-4\"\n                      >\n                        <div className=\"flex items-start justify-between gap-4\">\n                          <div>\n                            <div className=\"text-base font-semibold text-slate-900 dark:text-white\">\n                              {it.partId.name}\n                            </div>\n                            <div className=\"text-xs text-slate-500 dark:text-slate-400 mt-1\">\n                              {it.partId.sku ? `SKU: ${it.partId.sku} • ` : \"\"}{fmt(price)} each\n                              {it.selectedLocationId ? ` • ${it.selectedLocationId}` : \"\"}\n                            </div>\n                          </div>\n\n                          <button\n                            onClick={() => removeItem(pid)}\n                            disabled={busyId === pid}\n                            className=\"text-slate-400 hover:text-red-600 transition\"\n                            aria-label=\"Remove\"\n                          >\n                            <Trash2 className=\"w-5 h-5\" />\n                          </button>\n                        </div>\n\n                        <div className=\"mt-4 flex items-center justify-between gap-4\">\n                          {/* Qty controls */}\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              type=\"button\"\n                              onClick={() => updateQty(pid, Math.max(1, it.qty - 1))}\n                              disabled={busyId === pid}\n                              className=\"h-10 w-10 inline-flex items-center justify-center rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 transition\"\n                              aria-label=\"Decrease\"\n                            >\n                              <Minus className=\"w-4 h-4 text-blue-50\" />\n                            </button>\n                            <input\n                              type=\"number\"\n                              min={1}\n                              value={it.qty}\n                              onChange={(e) => {\n                                const v = Math.max(1, Number(e.target.value) || 1);\n                                updateQty(pid, v);\n                              }}\n                              className=\"w-20 text-center rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none\"\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={() => updateQty(pid, it.qty + 1)}\n                              disabled={busyId === pid}\n                              className=\"h-10 w-10 inline-flex items-center justify-center rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 transition\"\n                              aria-label=\"Increase\"\n                            >\n                              <Plus className=\"w-4 h-4 text-blue-50\" />\n                            </button>\n                          </div>\n\n                          {/* Line total */}\n                          <div className=\"text-right\">\n                            <div className=\"text-sm text-slate-500 dark:text-slate-400\">Line total</div>\n                            <div className=\"text-lg font-bold text-slate-900 dark:text-white\">\n                              {fmt(price * it.qty)}\n                            </div>\n                          </div>\n                        </div>\n                      </li>\n                    );\n                  })}\n                </ul>\n              </section>\n\n              {/* Summary */}\n              <aside className=\"lg:col-span-1\">\n                <div className=\"rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/70 backdrop-blur p-5 sticky top-6\">\n                  <h4 className=\"text-base font-semibold text-slate-900 dark:text-white\">Order Summary</h4>\n\n                  <div className=\"mt-4 space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-600 dark:text-slate-400\">Subtotal</span>\n                      <span className=\"font-medium text-slate-900 dark:text-white\">{fmt(totals.subtotal)}</span>\n                    </div>\n                    {/* Add tax/shipping rows here if you want */}\n                    <div className=\"pt-3 mt-3 border-t border-slate-200 dark:border-slate-700 flex justify-between text-base\">\n                      <span className=\"font-semibold text-slate-900 dark:text-white\">Total</span>\n                      <span className=\"font-bold text-slate-900 dark:text-white\">{fmt(totals.grand)}</span>\n                    </div>\n                  </div>\n\n                  <button\n                    onClick={goCheckout}\n                    disabled={cart.items.length === 0}\n                    className=\"mt-5 w-full inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-4 shadow-lg hover:shadow-xl transition\n                               disabled:from-slate-400 disabled:to-slate-500 disabled:cursor-not-allowed\n                               hover:scale-[1.01] active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  >\n                    <CreditCard className=\"w-4 h-4\" />\n                    Checkout with Stripe\n                  </button>\n\n                  <button\n                    onClick={() => router.push(\"/catalog\")}\n                    className=\"mt-3 w-full inline-flex items-center justify-center rounded-xl border bg-gradient-to-r from-green-600 to-green-300 border-slate-200 dark:border-slate-700 px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-800 transition\n                    hover:scale-[1.01] active:scale-95 focus:outline-none focus:ring-2 focus:ring-green-500\"\n                  >\n                    Continue shopping\n                  </button>\n                </div>\n              </aside>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}