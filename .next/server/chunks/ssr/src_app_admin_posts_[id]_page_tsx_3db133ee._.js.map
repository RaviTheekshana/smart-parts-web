{"version":3,"sources":["../../../../src/app/admin/posts/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport useSWR from \"swr\";\r\nimport { API, api } from \"@/lib/api\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nexport default function AdminPostEdit() {\r\n  const { id } = useParams() as { id: string };\r\n  const router = useRouter();\r\n  const { data, mutate } = useSWR<{ post: any }>(`/api/admin/posts/${id}`, api);\r\n\r\n  const [title, setTitle] = useState(\"\");\r\n  const [body, setBody] = useState(\"\");\r\n  const [published, setPublished] = useState(true);\r\n  const [make, setMake] = useState(\"\"); const [model, setModel] = useState(\"\");\r\n  const [yf, setYf] = useState(\"\"); const [yt, setYt] = useState(\"\");\r\n  const [partTags, setPartTags] = useState<string>(\"\");\r\n  const [newImage, setNewImage] = useState<File | null>(null);\r\n\r\n  useEffect(() => {\r\n    const p = data?.post;\r\n    if (!p) return;\r\n    setTitle(p.title || \"\");\r\n    setBody(p.body || \"\");\r\n    setPublished(!!p.published);\r\n    setMake(p.vehicleTags?.make || \"\"); setModel(p.vehicleTags?.model || \"\");\r\n    setYf(p.vehicleTags?.yearFrom ?? \"\"); setYt(p.vehicleTags?.yearTo ?? \"\");\r\n    setPartTags(Array.isArray(p.partTags) ? p.partTags.join(\", \") : \"\");\r\n  }, [data]);\r\n\r\n  async function save(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    const payload = {\r\n      title,\r\n      body,\r\n      published,\r\n      vehicleTags: {\r\n        make: make || undefined,\r\n        model: model || undefined,\r\n        yearFrom: yf ? Number(yf) : undefined,\r\n        yearTo: yt ? Number(yt) : undefined,\r\n      },\r\n      partTags: partTags\r\n        .split(\",\")\r\n        .map((s) => s.trim())\r\n        .filter(Boolean),\r\n    };\r\n    await api(`/api/admin/posts/${id}`, {\r\n      method: \"PATCH\",\r\n      body: JSON.stringify(payload),\r\n    });\r\n    mutate();\r\n    router.push(\"/admin/posts\");\r\n  }\r\n\r\n  if (!data) return <div>Loadingâ€¦</div>;\r\n\r\n  return (\r\n    <div className=\"max-w-3xl\">\r\n      <h1 className=\"text-2xl font-bold mb-4 text-slate-900\">Edit Post</h1>\r\n      <form onSubmit={save} className=\"space-y-4 bg-white border border-slate-200 rounded-2xl p-6\">\r\n        <input className=\"w-full border rounded-xl px-3 py-2\" value={title} onChange={(e)=>setTitle(e.target.value)} />\r\n        <textarea className=\"w-full border rounded-xl px-3 py-2 min-h-[120px]\" value={body} onChange={(e)=>setBody(e.target.value)} />\r\n        <div className=\"flex items-center gap-2\">\r\n          <input id=\"pub\" type=\"checkbox\" checked={published} onChange={(e)=>setPublished(e.target.checked)} />\r\n          <label htmlFor=\"pub\" className=\"text-sm\">Published (visible to users)</label>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n          <input className=\"border rounded-xl px-3 py-2\" placeholder=\"Make\" value={make} onChange={(e)=>setMake(e.target.value)} />\r\n          <input className=\"border rounded-xl px-3 py-2\" placeholder=\"Model\" value={model} onChange={(e)=>setModel(e.target.value)} />\r\n          <input className=\"border rounded-xl px-3 py-2\" placeholder=\"Year From\" type=\"number\" value={yf} onChange={(e)=>setYf(e.target.value)} />\r\n          <input className=\"border rounded-xl px-3 py-2\" placeholder=\"Year To\" type=\"number\" value={yt} onChange={(e)=>setYt(e.target.value)} />\r\n        </div>\r\n\r\n        <input className=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Part tags (comma separated)\" value={partTags} onChange={(e)=>setPartTags(e.target.value)} />\r\n        <div className=\"space-y-2\">\r\n  <label className=\"block text-sm font-medium text-slate-700\">Image</label>\r\n\r\n  {data?.post?.imageUrl ? (\r\n    <div className=\"rounded-xl border p-3\">\r\n      <img\r\n        src={`${API}${data.post.imageUrl}`}\r\n        alt=\"\"\r\n        className=\"max-h-64 rounded-lg border\"\r\n      />\r\n      <div className=\"mt-3 flex items-center gap-2\">\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/png,image/jpeg,image/jpg,image/webp\"\r\n          onChange={(e) => setNewImage(e.target.files?.[0] ?? null)}\r\n          className=\"text-sm\"\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={async () => {\r\n            if (!newImage) return alert(\"Choose a file first\");\r\n            const form = new FormData();\r\n            form.append(\"image\", newImage);\r\n            await fetch(`${process.env.NEXT_PUBLIC_API}/api/admin/posts/${id}/image`, {\r\n              method: \"POST\",\r\n              headers: { Authorization: `Bearer ${localStorage.getItem(\"token\") || \"\"}` },\r\n              body: form,\r\n            });\r\n            setNewImage(null);\r\n            await mutate();\r\n          }}\r\n          className=\"border rounded-xl px-3 py-2 text-sm hover:bg-slate-50\"\r\n        >\r\n          Replace\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={async () => {\r\n            if (!confirm(\"Remove image?\")) return;\r\n            await fetch(`${process.env.NEXT_PUBLIC_API}/api/admin/posts/${id}/image`, {\r\n              method: \"DELETE\",\r\n              headers: { Authorization: `Bearer ${localStorage.getItem(\"token\") || \"\"}` },\r\n            });\r\n            await mutate();\r\n          }}\r\n          className=\"text-red-600 hover:text-red-800 text-sm\"\r\n        >\r\n          Remove\r\n        </button>\r\n      </div>\r\n    </div>\r\n  ) : (\r\n    <div className=\"rounded-xl border p-3\">\r\n      <div className=\"text-sm text-slate-600 mb-2\">No image attached.</div>\r\n      <div className=\"flex items-center gap-2\">\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/png,image/jpeg,image/jpg,image/webp\"\r\n          onChange={(e) => setNewImage(e.target.files?.[0] ?? null)}\r\n          className=\"text-sm\"\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={async () => {\r\n            if (!newImage) return alert(\"Choose a file first\");\r\n            const form = new FormData();\r\n            form.append(\"image\", newImage);\r\n            await fetch(`${process.env.NEXT_PUBLIC_API}/api/admin/posts/${id}/image`, {\r\n              method: \"POST\",\r\n              headers: { Authorization: `Bearer ${localStorage.getItem(\"token\") || \"\"}` },\r\n              body: form,\r\n            });\r\n            setNewImage(null);\r\n            await mutate();\r\n          }}\r\n          className=\"border rounded-xl px-3 py-2 text-sm hover:bg-slate-50\"\r\n        >\r\n          Upload\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )}\r\n</div>\r\n\r\n        <button className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-xl\">Save</button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}