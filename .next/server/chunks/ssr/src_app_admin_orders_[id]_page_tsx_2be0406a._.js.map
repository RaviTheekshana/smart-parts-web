{"version":3,"sources":["../../../../src/app/admin/orders/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport useSWR from \"swr\";\r\nimport { api } from \"@/lib/api\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useState } from \"react\";\r\n\r\ntype Item = {\r\n  partId?: string;\r\n  name?: string;\r\n  sku?: string;\r\n  priceAtOrder?: number;\r\n  qty: number;\r\n  locationId?: string;\r\n};\r\ntype Order = {\r\n  _id: string;\r\n  userId?: string;\r\n  status: string;\r\n  totals?: { subtotal: number; tax?: number; grand: number };\r\n  items: Item[];\r\n  payment?: { provider?: string; status?: string; sessionId?: string; intentId?: string };\r\n  createdAt?: string;\r\n};\r\n\r\nexport default function AdminOrderDetail() {\r\n  const { id } = useParams() as { id: string };\r\n  const router = useRouter();\r\n  const { data, mutate } = useSWR<{ order: Order }>(`/api/admin/orders/${id}`, api);\r\n  const [saving, setSaving] = useState(false);\r\n  const order = data?.order;\r\n\r\n  const fmt = (n?: number) =>\r\n    typeof n === \"number\"\r\n      ? new Intl.NumberFormat(undefined, { style: \"currency\", currency: \"LKR\" }).format(n)\r\n      : \"-\";\r\n\r\n  async function updateStatus(status: string) {\r\n    setSaving(true);\r\n    try {\r\n      await api(`/api/admin/orders/${id}/status`, {\r\n        method: \"PATCH\",\r\n        body: JSON.stringify({ status }),\r\n      });\r\n      await mutate();\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  async function refund() {\r\n    if (!confirm(\"Issue Stripe refund and cancel order?\")) return;\r\n    setSaving(true);\r\n    try {\r\n      await api(`/api/admin/orders/${id}/refund`, { method: \"POST\" });\r\n      await mutate();\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  if (!order) return <div>Loading…</div>;\r\n\r\n  return (\r\n    <div className=\"space-y-6 max-w-4xl\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h1 className=\"text-2xl font-bold text-slate-900\">Order #{order._id.slice(-6).toUpperCase()}</h1>\r\n        <button className=\"border rounded-xl px-3 py-1\" onClick={() => router.push(\"/admin/orders\")}>Back</button>\r\n      </div>\r\n\r\n      <div className=\"bg-white border border-slate-200 rounded-2xl p-6 space-y-4\">\r\n        <div className=\"flex flex-wrap items-center gap-3\">\r\n          <div>\r\n            <div className=\"text-xs text-slate-500\">Status</div>\r\n            <div className=\"text-base font-semibold capitalize\">{order.status}</div>\r\n          </div>\r\n          <select\r\n            className=\"border rounded-xl px-3 py-2 text-sm\"\r\n            onChange={(e) => updateStatus(e.target.value)}\r\n            defaultValue=\"\"\r\n          >\r\n            <option value=\"\" disabled>Update status…</option>\r\n            <option value=\"pending\">pending</option>\r\n            <option value=\"paid\">paid</option>\r\n            <option value=\"fulfilled\">fulfilled</option>\r\n            <option value=\"cancelled\">cancelled</option>\r\n          </select>\r\n\r\n          {order.payment?.provider === \"stripe\" && order.status !== \"cancelled\" && (\r\n            <button\r\n              onClick={refund}\r\n              disabled={saving}\r\n              className=\"ml-auto bg-red-600 text-white px-3 py-2 rounded-xl hover:bg-red-700\"\r\n            >\r\n              Refund (Stripe)\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"overflow-x-auto rounded-xl border border-slate-200\">\r\n          <table className=\"min-w-full text-sm bg-white\">\r\n            <thead>\r\n              <tr className=\"border-b border-slate-200 text-left text-slate-600\">\r\n                <th className=\"py-2 px-4\">SKU</th>\r\n                <th className=\"py-2 px-4\">Name</th>\r\n                <th className=\"py-2 px-4\">Qty</th>\r\n                <th className=\"py-2 px-4\">Unit</th>\r\n                <th className=\"py-2 px-4\">Location</th>\r\n                <th className=\"py-2 px-4\">Line</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {order.items.map((it, i) => (\r\n                <tr key={i} className=\"border-b border-slate-200\">\r\n                  <td className=\"py-2 px-4 font-mono\">{it.sku ?? \"—\"}</td>\r\n                  <td className=\"py-2 px-4\">{it.name ?? \"—\"}</td>\r\n                  <td className=\"py-2 px-4\">{it.qty}</td>\r\n                  <td className=\"py-2 px-4\">{fmt(it.priceAtOrder)}</td>\r\n                  <td className=\"py-2 px-4\">{it.locationId ?? \"—\"}</td>\r\n                  <td className=\"py-2 px-4\">{fmt((it.priceAtOrder ?? 0) * it.qty)}</td>\r\n                </tr>\r\n              ))}\r\n              {order.items.length === 0 && (\r\n                <tr><td className=\"py-4 px-4 text-center text-slate-500\" colSpan={6}>No items</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"grid sm:grid-cols-3 gap-3\">\r\n          <Stat label=\"Subtotal\" value={fmt(order.totals?.subtotal)} />\r\n          <Stat label=\"Tax\" value={fmt(order.totals?.tax)} />\r\n          <Stat label=\"Grand Total\" value={fmt(order.totals?.grand)} />\r\n        </div>\r\n\r\n        <div className=\"text-sm text-slate-600\">\r\n          Payment: {order.payment?.provider ?? \"—\"} • {order.payment?.status ?? \"—\"}\r\n          <br />\r\n          Placed: {order.createdAt ? new Date(order.createdAt).toLocaleString() : \"—\"}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Stat({ label, value }: { label: string; value: string }) {\r\n  return (\r\n    <div className=\"rounded-xl border border-slate-200 bg-white p-4\">\r\n      <div className=\"text-xs text-slate-500\">{label}</div>\r\n      <div className=\"text-lg font-semibold\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}